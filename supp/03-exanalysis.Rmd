# Experimental sample - analysis

The `inc2` field in the qdataEX file relates to the differences in shape that were noted when reviewing general incision morphology. Some were U-shaped and narrow, others U-shaped and wide (twice as wide as they are deep), and the remainder were V-shaped. The V-shaped incisions were the only incisions made by multiple tools. In this study, the narrow and wide U-shaped incisions were made by different tools; however, it is not difficult to imagine a scenario where both of the U-shaped incisions could also have been produced with two different sides of the same tool. It is thus necessary to use abundant caution when interpreting potential tool shape, or the number of tools employed in the application of incisions. To avoid confounding the issue, the tip of each of the tools used to generate the incision is referred to as a bit in the remainder of this document. Tools may have multiple bits, but each bit is capable of generating different incision profiles.

```{r loadsetwdEX, out.width = "100%", dpi = 300, echo=TRUE, warning=FALSE}
# library(devtools)
# devtools::install_github("geomorphR/geomorph", ref = "Stable", build_vignettes = TRUE)
library(geomorph)
library(wesanderson)
setwd(getwd())
source('readmulti.csv.R')

# Read .csv files
setwd("./dataEX")
filelist <- list.files(pattern = ".csv")
coords<-readmulti.csv(filelist)
setwd("../")

# read qualitative data
qdata<-read.csv("qdataEX.csv",header=TRUE,row.names=1)
qdata<-qdata[match(dimnames(coords)[[3]],rownames(qdata)),]
qdata
```

## Generalised Procrustes Analysis

```{r gpaEX, out.width = "100%", dpi = 300, echo=TRUE, warning=FALSE}
Y.gpa<-gpagen(coords, PrinAxes = TRUE, ProcD = TRUE, Proj = TRUE, print.progress = FALSE)

# 3D GPA plot
knitr::include_graphics('images/gpa3dEX.png')
fig.cap="Results of generalised Procrustes analysis."

# geomorph data frame
gdf<-geomorph.data.frame(shape=Y.gpa$coords, size=Y.gpa$Csize, incision=qdata$incision, inc2=qdata$inc2)
csz<-Y.gpa$Csize # attribute for boxplot
inc<-qdata$incision
inc2<-qdata$inc2 # attribute for boxplot

# boxplot of incision (centroid) size by incision profile (inc)
boxplot(csz~inc, 
        main = "Centroid size of experimental incisions by profile",
        names = c("U", "V"),
        xlab = "Incision Profile",
        ylab = "Centroid Size",
        col = wes_palette("Moonrise2")
        )
fig.cap="Boxplot of experimental incision profile types (U-shaped and V-shaped)."

# boxplot of incision (centroid) size by incision profile (inc2)
boxplot(csz~inc2, 
        main = "Centroid size of experimental incisions by profile type",
        names = c("Un", "Uw", "V"),
        xlab = "Incision Profile (inc2)",
        ylab = "Centroid Size",
        col = wes_palette("Moonrise2")
        )
fig.cap="Boxplot of experimental incision profile types (U-narrow, U-Wide, and V)."
```

## Principal Components Analysis

```{r pcaEX, out.width = "100%", dpi = 300, echo=TRUE, warning=FALSE}
# principal components analysis
pca<-gm.prcomp(Y.gpa$coords)
summary(pca)

# set plot parameters
pch.gps.2 <- c(15,17,19)[as.factor(inc2)]
col.gps.2 <- wes_palette("Moonrise2")[as.factor(inc2)]

# plotPCAbyinc2
pca<-plot(pca,
          pch = pch.gps.2,
          col = col.gps.2)
```

## Define models

```{r defmodEX, out.width = "100%", dpi = 300, echo=TRUE, warning=FALSE}
fit.size<-procD.lm(shape ~ size, data = gdf, print.progress = FALSE, iter = 9999)
fit.sizeinc<-procD.lm(size ~ inc2, data = gdf, print.progress = FALSE, iter = 9999)
fit.shapeinc<-procD.lm(shape ~ inc2, data = gdf, print.progress = FALSE, iter = 9999)
```

## Size/Shape ~ Incision Profile?

```{r shszsiteEX, out.width = "100%", dpi = 300, echo=TRUE, warning=FALSE}
# ANOVA: allometry?
anova(fit.size)

# ANOVA: do incision sizes differ by profile?
anova(fit.sizeinc)
# pairwise comparison of LS means = which differ?
sz.inc<-pairwise(fit.sizeinc, groups = qdata$inc2)
summary(sz.inc, confidence = 0.95, test.type = "dist")
# pairwise distance between variances = standardization?
summary(sz.inc, confidence = 0.95, test.type = "var")

# ANOVA: do incision shapes differ by profile?
anova(fit.shapeinc)
# pairwise comparison of LS means = which differ?
sh.inc<-pairwise(fit.shapeinc, groups = qdata$inc2)
summary(sh.inc, confidence = 0.95, test.type = "dist")
# pairwise distance between variances = standardization?
summary(sh.inc, confidence = 0.95, test.type = "var")
```

## Morphological disparity

```{r m-disparityEX}
# morphological disparity: does incision morphology display greater shape variation among individuals relative to incision profile shape?
morphol.disparity(fit.shapeinc, groups = qdata$inc2, data = gdf, print.progress = FALSE, iter = 9999)

# morphological disparity: does incision morphology display greater size variation among individuals relative to incision profile size?
morphol.disparity(fit.sizeinc, groups = qdata$inc2, data = gdf, print.progress = FALSE, iter = 9999)
```

## Mean shapes

```{r m-shapesEX}
# subset landmark coordinates to produce mean shapes by site
new.coords<-coords.subset(A = Y.gpa$coords, group = qdata$inc2)
names(new.coords)
# group shape means
mean<-lapply(new.coords, mshape)
# plot(mean$Uw)

# mean shapes
knitr::include_graphics('images/mshapeEX.png')
fig.cap="Mean shapes for incision profiles Un, Uw, and V."
# end of code
```
